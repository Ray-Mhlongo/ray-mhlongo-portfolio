<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="SQL portfolio deep dive for Ray Mhlongo." />
  <title>SQL | Ray Mhlongo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="vanta-net" aria-hidden="true"></div>
  <div id="app" aria-hidden="true">
    <canvas id="canvas"></canvas>
  </div>
  <a class="skip-link" href="#main-content">Skip to main content</a>
  <header class="site-header">
    <nav class="navbar container" aria-label="Primary">
      <a class="brand brand-with-logo" href="index.html">Data Insights by Ray</a>
      <button class="nav-toggle" aria-controls="nav-list" aria-expanded="false"><span class="sr-only">Open menu</span>☰</button>
      <ul id="nav-list" class="nav-list">
        <li><a class="nav-link" href="index.html">Home</a></li>
        <li><a class="nav-link" href="about.html">About</a></li>
        <li><a class="nav-link" href="projects.html">Projects</a></li>
        <li><a class="nav-link" href="contact.html">Contact</a></li>
      </ul>
      <button class="theme-toggle" type="button" aria-pressed="false">Light mode</button>
    </nav>
  </header>

  <main id="main-content" class="container page-main">
    <section class="section reveal">
      <div class="skill-page-hero">
        <div>
          <p class="hero-eyebrow">South Africa SQL Capability</p>
          <h1>SQL Deep Dive: Church Survey</h1>
          <p class="lead">I design reliable schemas, write analytical queries that scale, and translate church survey questions into production-ready SQL. Explore the mini emulators below to see how I analyze tenure, attendance, serving, and welcoming sentiment.</p>
          <div class="hero-actions">
            <a class="btn btn-primary" href="projects.html">See SQL Projects</a>
            <a class="btn btn-secondary" href="index.html#skills-polish-title">Back to Skills</a>
          </div>
        </div>
        <div class="skill-stats">
          <div class="skill-stat-card">
            <h3>Query Design</h3>
            <p>CTEs, window functions, subqueries, and reusable views for SA datasets.</p>
          </div>
          <div class="skill-stat-card">
            <h3>Data Modeling</h3>
            <p>Normalized schemas, fact/dimension layouts, and data quality guards.</p>
          </div>
          <div class="skill-stat-card">
            <h3>Performance</h3>
            <p>Index strategy, selective filters, and explain-plan reviews.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="section reveal" aria-labelledby="sql-playground-title">
      <div class="section-heading">
        <h2 id="sql-playground-title">Interactive SQL Emulators</h2>
        <p>Each emulator simulates a real analytics question using the church survey response tables.</p>
      </div>
      <div class="terminal-grid" data-sql-grid>
        <article class="terminal-card">
          <div class="terminal-header">
            <h3>Welcoming Trend by Month</h3>
            <span>fact_survey_responses + dim_calendar</span>
          </div>
          <textarea class="terminal-input" data-sql-input="trend" spellcheck="false">WITH monthly AS (
  SELECT
    c.month_name,
    COUNT(*) AS responses,
    SUM(CASE WHEN r.welcoming = 'Very welcoming' THEN 1 ELSE 0 END) AS very_welcoming
  FROM fact_survey_responses r
  JOIN dim_calendar c ON r.date_id = c.date_id
  WHERE c.year = 2026
  GROUP BY c.month_name
)
SELECT
  month_name,
  responses,
  ROUND(very_welcoming * 100.0 / NULLIF(responses, 0), 1) AS very_welcoming_pct
FROM monthly
ORDER BY responses DESC;</textarea>
          <div class="terminal-actions">
            <button class="btn btn-primary" data-sql-run="trend">Run Query</button>
            <button class="btn btn-secondary" data-sql-reset="trend">Reset</button>
          </div>
          <pre class="terminal-output" data-sql-output="trend">Press Run Query to execute the emulator.</pre>
        </article>

        <article class="terminal-card">
          <div class="terminal-header">
            <h3>Serving Participation by Tenure</h3>
            <span>dim_attendees + fact_survey_responses</span>
          </div>
          <textarea class="terminal-input" data-sql-input="cohort" spellcheck="false">SELECT`n  a.tenure_bucket,`n  COUNT(*) AS responses,`n  SUM(CASE WHEN r.serving = 'Yes' THEN 1 ELSE 0 END) AS serving_count,`n  ROUND(SUM(CASE WHEN r.serving = 'Yes' THEN 1 ELSE 0 END) * 100.0 / NULLIF(COUNT(*), 0), 1) AS serving_rate`nFROM fact_survey_responses r`nJOIN dim_attendees a ON r.attendee_id = a.attendee_id`nGROUP BY a.tenure_bucket`nORDER BY serving_rate DESC;</textarea>
          <div class="terminal-actions">
            <button class="btn btn-primary" data-sql-run="cohort">Run Query</button>
            <button class="btn btn-secondary" data-sql-reset="cohort">Reset</button>
          </div>
          <pre class="terminal-output" data-sql-output="cohort">Press Run Query to execute the emulator.</pre>
        </article>

        <article class="terminal-card">
          <div class="terminal-header">
            <h3>Invite Likelihood vs Communication</h3>
            <span>fact_survey_responses + dim_communication</span>
          </div>
          <textarea class="terminal-input" data-sql-input="pricing" spellcheck="false">SELECT`n  c.communication_rating,`n  COUNT(*) AS responses,`n  ROUND(AVG(CASE`n    WHEN r.invite_likelihood IN ('Likely', 'Very likely') THEN 1 ELSE 0`n  END) * 100.0, 1) AS invite_rate`nFROM fact_survey_responses r`nJOIN dim_communication c ON r.communication_id = c.communication_id`nGROUP BY c.communication_rating`nORDER BY invite_rate DESC;</textarea>
          <div class="terminal-actions">
            <button class="btn btn-primary" data-sql-run="pricing">Run Query</button>
            <button class="btn btn-secondary" data-sql-reset="pricing">Reset</button>
          </div>
          <pre class="terminal-output" data-sql-output="pricing">Press Run Query to execute the emulator.</pre>
        </article>
      </div>
    </section>

    <section class="section reveal" aria-labelledby="sql-model-title">
      <div class="section-heading">
        <h2 id="sql-model-title">Schema I Build For Analytics</h2>
        <p>Reusable, documented, and easy for downstream dashboards in SA teams.</p>
      </div>
      <div class="grid details">
        <article class="detail-card">
          <h3>Fact Tables</h3>
          <ul>
            <li>fact_survey_responses (response grain)</li>
            <li>fact_attendance (service attendance history)</li>
            <li>fact_volunteering (serving participation)</li>
          </ul>
        </article>
        <article class="detail-card">
          <h3>Dimension Tables</h3>
          <ul>
            <li>dim_calendar (fiscal, custom periods)</li>
            <li>dim_attendees (tenure and demographics)</li>
            <li>dim_communication (channel satisfaction)</li>
          </ul>
        </article>
      </div>
    </section>
  </main>

  <footer class="site-footer"><div class="container footer-inner"><p>© <span id="year"></span> Ray Mhlongo</p><p>Handcrafted with semantic HTML, modern CSS, and vanilla JavaScript.</p></div></footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vantavanta.net.min.js"></script>
  <script>
    window.vantaNet = VANTA.NET({
      el: "#vanta-net",
      mouseControls: true,
      touchControls: true,
      gyroControls: false,
      minHeight: 200.00,
      minWidth: 200.00,
      scale: 1.00,
      scaleMobile: 1.00,
      color: 0x164cc9,
      backgroundColor: 0x090f1b
    });
  </script>
  <script type="module" src="tubes-cursor.js"></script>
  <script src="script.js"></script>
  <script>
    const sqlDefaults = {
      trend: document.querySelector('[data-sql-input="trend"]').value,
      cohort: document.querySelector('[data-sql-input="cohort"]').value,
      pricing: document.querySelector('[data-sql-input="pricing"]').value
    };

    const sqlOutputs = {
      trend: `month_name | responses | very_welcoming_pct\n-----------+-----------+--------------------\nFebruary   | 12        | 75.0\nJanuary    | 28        | 64.3\nDecember   | 9         | 55.6\nNovember   | 7         | 57.1\nOctober    | 5         | 60.0`,
      cohort: `tenure_bucket | responses | serving_count | serving_rate\n--------------+-----------+---------------+-------------\n3+ years      | 18        | 9             | 50.0\n1-3 years     | 12        | 2             | 16.7\n6–12 months   | 4         | 2             | 50.0\nNew here      | 1         | 0             | 0.0`,
      pricing: `communication_rating | responses | invite_rate\n----------------------+-----------+------------\nVery satisfied        | 14        | 78.6\nSatisfied             | 10        | 60.0\nNeutral               | 5         | 40.0\nVery dissatisfied     | 1         | 0.0`
    };

    const fallbackMessage = "Emulator tip: use the provided query or a close variant to see the expected output.";

    document.querySelectorAll('[data-sql-run]').forEach(button => {
      button.addEventListener('click', () => {
        const key = button.getAttribute('data-sql-run');
        const input = document.querySelector(`[data-sql-input="${key}"]`).value;
        const output = document.querySelector(`[data-sql-output="${key}"]`);
        if (input.trim().length < 20) {
          output.textContent = fallbackMessage;
          return;
        }
        output.textContent = sqlOutputs[key] || fallbackMessage;
      });
    });

    document.querySelectorAll('[data-sql-reset]').forEach(button => {
      button.addEventListener('click', () => {
        const key = button.getAttribute('data-sql-reset');
        document.querySelector(`[data-sql-input="${key}"]`).value = sqlDefaults[key];
        document.querySelector(`[data-sql-output="${key}"]`).textContent = "Press Run Query to execute the emulator.";
      });
    });
  </script>
</body>
</html>


