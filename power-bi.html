<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Power BI portfolio deep dive for Ray Mhlongo." />
  <title>Power BI | Ray Mhlongo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="vanta-net" aria-hidden="true"></div>
  <div id="app" aria-hidden="true">
    <canvas id="canvas"></canvas>
  </div>
  <a class="skip-link" href="#main-content">Skip to main content</a>
  <header class="site-header">
    <nav class="navbar container" aria-label="Primary">
      <a class="brand brand-with-logo" href="index.html">Data Insights by Ray</a>
      <button class="nav-toggle" aria-controls="nav-list" aria-expanded="false"><span class="sr-only">Open menu</span>☰</button>
      <ul id="nav-list" class="nav-list">
        <li><a class="nav-link" href="index.html">Home</a></li>
        <li><a class="nav-link" href="about.html">About</a></li>
        <li><a class="nav-link" href="projects.html">Projects</a></li>
        <li><a class="nav-link" href="contact.html">Contact</a></li>
      </ul>
      <button class="theme-toggle" type="button" aria-pressed="false">Light mode</button>
    </nav>
  </header>

  <main id="main-content" class="container page-main">
    <section class="section reveal">
      <div class="skill-page-hero">
        <div>
          <p class="hero-eyebrow">Power BI Portfolio</p>
          <h1>Church Survey Dashboard</h1>
          <p class="lead">I translate church survey responses into clear Power BI stories: KPI scorecards, trend visuals, and decision-ready narratives. Use the time filters below to see the dashboard update in real time.</p>
          <div class="hero-actions">
            <a class="btn btn-primary" href="projects.html">See Power BI Projects</a>
            <a class="btn btn-secondary" href="index.html#skills-polish-title">Back to Skills</a>
          </div>
        </div>
        <div class="skill-stats">
          <div class="skill-stat-card">
            <h3>Data Prep</h3>
            <p>Power Query transformations, KPI definitions, and model refresh checks.</p>
          </div>
          <div class="skill-stat-card">
            <h3>Modeling</h3>
            <p>Star schema, DAX measures, and governance-friendly datasets.</p>
          </div>
          <div class="skill-stat-card">
            <h3>Storytelling</h3>
            <p>Clean visuals, commentary callouts, and action-based dashboards.</p>
          </div>
        </div>
        <div class="schema-visual" aria-hidden="true">
          <svg viewBox="0 0 520 320" role="img" focusable="false">
            <defs>
              <linearGradient id="schemaGlow" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="#4ab6ff"/>
                <stop offset="100%" stop-color="#2c6cff"/>
              </linearGradient>
              <filter id="schemaBlur" x="-30%" y="-30%" width="160%" height="160%">
                <feGaussianBlur stdDeviation="6" result="blur"/>
                <feMerge>
                  <feMergeNode in="blur"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
              <marker id="arrowHead" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto">
                <path d="M0,0 L8,4 L0,8 Z" fill="#6fd0ff"/>
              </marker>
            </defs>
            <g class="schema-links" filter="url(#schemaBlur)">
              <line x1="260" y1="150" x2="110" y2="70" marker-end="url(#arrowHead)"/>
              <line x1="260" y1="150" x2="410" y2="70" marker-end="url(#arrowHead)"/>
              <line x1="260" y1="150" x2="110" y2="240" marker-end="url(#arrowHead)"/>
              <line x1="260" y1="150" x2="410" y2="240" marker-end="url(#arrowHead)"/>
            </g>
            <g class="schema-node fact">
              <rect x="200" y="110" width="120" height="80" rx="16"/>
              <text x="260" y="145">fact_survey</text>
              <text x="260" y="168">responses</text>
            </g>
            <g class="schema-node dim">
              <rect x="40" y="40" width="140" height="60" rx="14"/>
              <text x="110" y="70">dim_attendees</text>
            </g>
            <g class="schema-node dim">
              <rect x="340" y="40" width="140" height="60" rx="14"/>
              <text x="410" y="70">dim_calendar</text>
            </g>
            <g class="schema-node dim">
              <rect x="40" y="210" width="140" height="60" rx="14"/>
              <text x="110" y="240">dim_communication</text>
            </g>
            <g class="schema-node dim">
              <rect x="340" y="210" width="140" height="60" rx="14"/>
              <text x="410" y="240">dim_attendance</text>
            </g>
          </svg>
        </div>
      </div>
    </section>

    <section class="section reveal" aria-labelledby="bi-dashboard-title">
      <div class="section-heading">
        <h2 id="bi-dashboard-title">Interactive KPI Dashboard</h2>
        <p>Survey data view with dynamic time filters.</p>
      </div>
      <div class="chip-row" data-range-row>
        <button class="filter-chip active" data-range="30">Last 30 Days</button>
        <button class="filter-chip" data-range="90">Last 90 Days</button>
        <button class="filter-chip" data-range="180">Last 180 Days</button>
      </div>
      <div class="dashboard">
        <div>
          <div class="metric-grid" data-bi-metrics>
            <div class="metric-card">
              <h4>Total Responses</h4>
              <p data-bi-metric="responses">0</p>
            </div>
            <div class="metric-card">
              <h4>Very Welcoming</h4>
              <p data-bi-metric="welcoming">0%</p>
            </div>
            <div class="metric-card">
              <h4>Serving Rate</h4>
              <p data-bi-metric="serving">0%</p>
            </div>
          </div>
          <div class="chart-bar" aria-label="Attendance frequency">
            <div class="legend-row">
              <span>Attendance Frequency</span>
              <span data-bi-total></span>
            </div>
            <div class="bar-row" data-bi-bars>
              <div>
                <div class="legend-row"><span>Every week</span><span data-bi-label="Every week">0</span></div>
                <div class="bar" data-bi-bar="Every week" style="width: 0%"></div>
              </div>
              <div>
                <div class="legend-row"><span>Most weeks</span><span data-bi-label="Most weeks">0</span></div>
                <div class="bar" data-bi-bar="Most weeks" style="width: 0%"></div>
              </div>
              <div>
                <div class="legend-row"><span>Once in a while</span><span data-bi-label="Once in a while">0</span></div>
                <div class="bar" data-bi-bar="Once in a while" style="width: 0%"></div>
              </div>
            </div>
          </div>
        </div>
        <article class="detail-card">
          <h3>Executive Notes</h3>
          <ul>
            <li>Monitor welcoming scores for newcomers to improve first-time retention.</li>
            <li>Serving rate highlights where ministry teams may need onboarding support.</li>
            <li>Communication satisfaction signals if updates are landing effectively.</li>
          </ul>
        </article>
      </div>
    </section>

    <section class="section reveal" aria-labelledby="bi-stack-title">
      <div class="section-heading">
        <h2 id="bi-stack-title">Power BI Stack</h2>
        <p>Built for trust, performance, and stakeholder adoption.</p>
      </div>
      <div class="grid details">
        <article class="detail-card">
          <h3>Model</h3>
          <ul>
            <li>Star schema with fact responses + dimensions.</li>
            <li>DAX measures for sentiment, serving rate, and invite likelihood.</li>
            <li>Relationship design: one-to-many, many-to-one, and bi-directional when justified.</li>
            <li>Bridge tables and role-playing dimensions for time intelligence.</li>
          </ul>
        </article>
        <article class="detail-card">
          <h3>Distribution</h3>
          <ul>
            <li>Role-based views for Sales, Revenue Ops, and Leadership.</li>
            <li>Automated refresh and alerting for KPI dips.</li>
          </ul>
        </article>
        <article class="detail-card">
          <h3>Junior Analyst Power BI Skills</h3>
          <ul>
            <li>Data modeling: relationships, cardinality, and filter direction.</li>
            <li>Power Query basics: merge, append, data types, and columns.</li>
            <li>Visualization: KPI cards, slicers, tooltips, and drill-through.</li>
            <li>Governance: naming standards, measure folders, and QA checks.</li>
          </ul>
        </article>
      </div>
    </section>
  </main>

  <footer class="site-footer"><div class="container footer-inner"><p>© <span id="year"></span> Ray Mhlongo</p><p>Handcrafted with semantic HTML, modern CSS, and vanilla JavaScript.</p></div></footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vantavanta.net.min.js"></script>
  <script>
    window.vantaNet = VANTA.NET({
      el: "#vanta-net",
      mouseControls: true,
      touchControls: true,
      gyroControls: false,
      minHeight: 200.00,
      minWidth: 200.00,
      scale: 1.00,
      scaleMobile: 1.00,
      color: 0x164cc9,
      backgroundColor: 0x090f1b
    });
  </script>
  <script type="module" src="tubes-cursor.js"></script>
  <script src="script.js"></script>
  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSxJjE9vK1zeGHt-CwLPsriQqh3gNYdDqF24kjMvTTuShdzOcmWzQ0Tr7jaaJ-XZL2TUFa88lTORk5U/pub?output=csv";

    const parseCSV = text => {
      const rows = [];
      let row = [];
      let current = "";
      let inQuotes = false;

      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const next = text[i + 1];

        if (char === '"' && inQuotes && next === '"') {
          current += '"';
          i++;
          continue;
        }
        if (char === '"') {
          inQuotes = !inQuotes;
          continue;
        }
        if (char === "," && !inQuotes) {
          row.push(current.trim());
          current = "";
          continue;
        }
        if ((char === "\n" || char === "\r") && !inQuotes) {
          if (current.length || row.length) {
            row.push(current.trim());
            rows.push(row);
          }
          row = [];
          current = "";
          continue;
        }
        current += char;
      }

      if (current.length || row.length) {
        row.push(current.trim());
        rows.push(row);
      }
      return rows.filter(r => r.length && r.some(cell => cell.length));
    };

    const normalize = value => (value || "").trim();

    const toSurveyRows = rows => {
      const [header, ...dataRows] = rows;
      const index = name => header.indexOf(name);

      const idx = {
        timestamp: index("Timestamp"),
        tenure: index("How long have you been attending the church?"),
        attendance: index("How often do you usually attend?"),
        welcoming: index("How welcoming does the church feel to you?"),
        serving: index("Are you currently serving in a team?"),
        invite: index("How likely are you to invite someone to church?"),
        communication: index("How satisfied are you with the church communication (WhatsApp, emails, announcements)?")
      };

      return dataRows.map(row => ({
        timestamp: normalize(row[idx.timestamp]),
        tenure: normalize(row[idx.tenure]) || "Unspecified",
        attendance: normalize(row[idx.attendance]) || "Unspecified",
        welcoming: normalize(row[idx.welcoming]) || "Unspecified",
        serving: normalize(row[idx.serving]) || "No",
        invite: normalize(row[idx.invite]) || "Not sure",
        communication: normalize(row[idx.communication]) || "Unspecified"
      })).filter(row => row.timestamp);
    };

    const parseDate = value => {
      const match = value.match(/^(\d{2})\/(\d{2})\/(\d{4})/);
      if (!match) return null;
      const [, day, month, year] = match;
      return new Date(Number(year), Number(month) - 1, Number(day));
    };

    const formatPercent = value => `${Math.round(value)}%`;

    const updateDashboard = (surveyData, rangeDays) => {
      const now = new Date();
      const cutoff = new Date(now.getFullYear(), now.getMonth(), now.getDate() - rangeDays);
      const filtered = surveyData.filter(row => {
        const date = parseDate(row.timestamp);
        return date && date >= cutoff;
      });

      const total = filtered.length;
      const veryWelcoming = filtered.filter(row => row.welcoming.toLowerCase() === "very welcoming").length;
      const serving = filtered.filter(row => row.serving.toLowerCase() === "yes").length;

      document.querySelector('[data-bi-metric="responses"]').textContent = total.toLocaleString("en-ZA");
      document.querySelector('[data-bi-metric="welcoming"]').textContent = total ? formatPercent((veryWelcoming / total) * 100) : "0%";
      document.querySelector('[data-bi-metric="serving"]').textContent = total ? formatPercent((serving / total) * 100) : "0%";
      document.querySelector('[data-bi-total]').textContent = `${total} responses`;

      const attendanceBuckets = {
        "Every week": 0,
        "Most weeks": 0,
        "Once in a while": 0
      };

      filtered.forEach(row => {
        if (attendanceBuckets[row.attendance] !== undefined) {
          attendanceBuckets[row.attendance] += 1;
        }
      });

      const attendanceTotal = Object.values(attendanceBuckets).reduce((sum, value) => sum + value, 0);

      Object.keys(attendanceBuckets).forEach(segment => {
        const value = attendanceBuckets[segment];
        const width = attendanceTotal === 0 ? 0 : Math.round((value / attendanceTotal) * 100);
        document.querySelector(`[data-bi-label="${segment}"]`).textContent = value.toLocaleString("en-ZA");
        document.querySelector(`[data-bi-bar="${segment}"]`).style.width = `${width}%`;
      });
    };

    fetch(sheetUrl)
      .then(response => response.text())
      .then(csvText => {
        const rows = parseCSV(csvText);
        const surveyData = toSurveyRows(rows);

        document.querySelectorAll('[data-range]').forEach(button => {
          button.addEventListener('click', () => {
            document.querySelectorAll('[data-range]').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            updateDashboard(surveyData, Number(button.dataset.range));
          });
        });

        updateDashboard(surveyData, 30);
      })
      .catch(() => {
        const fallback = [
          { timestamp: "18/01/2026 13:59:46", attendance: "Every week", welcoming: "Slightly welcoming", serving: "Yes" },
          { timestamp: "21/01/2026 09:26:31", attendance: "Most weeks", welcoming: "Very welcoming", serving: "No" },
          { timestamp: "01/02/2026 20:44:38", attendance: "Most weeks", welcoming: "Not welcoming", serving: "No" },
          { timestamp: "02/02/2026 16:53:11", attendance: "Most weeks", welcoming: "Very welcoming", serving: "No" }
        ];

        document.querySelectorAll('[data-range]').forEach(button => {
          button.addEventListener('click', () => {
            document.querySelectorAll('[data-range]').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            updateDashboard(fallback, Number(button.dataset.range));
          });
        });

        updateDashboard(fallback, 30);
      });
  </script>
</body>
</html>
